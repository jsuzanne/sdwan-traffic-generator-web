# SD-WAN Traffic Generator - "Latest" Host Mode Configuration
# ⚠️ This is for testing the Zero-Config Host Mode experience.
# ⚠️ Not recommended for stable production use until validated.

services:
  # Web Dashboard - User Interface and API
  sdwan-web-ui:
    image: jsuzanne/sdwan-web-ui:latest
    container_name: sdwan-web-ui
    network_mode: host
    cap_add:
      - NET_ADMIN
      - NET_RAW

    # In host mode, ports are accessed directly.
    # Default is 8080 (can be changed via PORT env var)

    environment:
      - JWT_SECRET=your-super-secret-jwt-key
      - CONFIG_DIR=/app/config
      - LOG_DIR=/var/log/sdwan-traffic-gen
      # Ensure Host Mode uses the standard port unless overridden
      - PORT=${WEB_UI_PORT:-8080}
      - DEBUG=false

      # Prisma SD-WAN API Credentials
      - PRISMA_SDWAN_REGION=${PRISMA_SDWAN_REGION:-}
      - PRISMA_SDWAN_TSGID=${PRISMA_SDWAN_TSGID:-}
      - PRISMA_SDWAN_CLIENT_ID=${PRISMA_SDWAN_CLIENT_ID:-}
      - PRISMA_SDWAN_CLIENT_SECRET=${PRISMA_SDWAN_CLIENT_SECRET:-}

    volumes:
      - ./config:/app/config
      - ./logs:/var/log/sdwan-traffic-gen

    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:${WEB_UI_PORT:-8080}/api/version" ]
      interval: 10s
      timeout: 5s
      retries: 5

  # Traffic Generator - Background Traffic Simulation
  sdwan-traffic-gen:
    image: jsuzanne/sdwan-traffic-gen:latest
    container_name: sdwan-traffic-gen
    network_mode: host
    environment:
      - SLEEP_BETWEEN_REQUESTS=1
      - CLIENT_ID=client01
      - DEBUG=false
    volumes:
      - ./config:/opt/sdwan-traffic-gen/config
      - ./logs:/var/log/sdwan-traffic-gen
    restart: unless-stopped
    depends_on:
      sdwan-web-ui:
        condition: service_healthy

  # Voice Traffic Generator - RTP/Voice Simulation
  sdwan-voice-gen:
    image: jsuzanne/sdwan-voice-gen:latest
    container_name: sdwan-voice-gen
    network_mode: host
    cap_add:
      - NET_ADMIN
      - NET_RAW
    environment:
      - DEBUG=false
    volumes:
      - ./config:/app/config
      - ./logs:/var/log/sdwan-traffic-gen
    restart: unless-stopped
    depends_on:
      sdwan-web-ui:
        condition: service_healthy

  # Voice Echo Server - Target for Voice Tests
  sdwan-voice-echo:
    image: jsuzanne/sdwan-voice-echo:latest
    container_name: sdwan-voice-echo
    network_mode: host
    restart: unless-stopped
    environment:
      - DEBUG=false
