Context: You are integrating Prisma SD-WAN egress path detection into an existing React/Node.js SD-WAN traffic generation application deployed in Docker containers at branch sites.

Read the full specification document above, then implement the following:

PHASE 1: Backend Implementation
Create src/backend/services/PrismaPathService.ts

Implement site auto-detection on startup using ./scripts/getflow.py --auto-detect --json

Implement path query method using ./scripts/getflow.py --site-name <site> --udp-src-port <port> --json

Add hardened Python execution with timeouts (10s startup, 5s runtime)

Implement graceful degradation (never crash, log warnings only)

Store site info in memory: siteName, siteId, available

Update src/backend/services/TestManager.ts

Add pathInfo: PathResult | null to test state

Implement schedulePathPolling(testId, udpPort) method

Initial delay: 2 minutes, then poll every 30 seconds

Store polling intervals for cleanup

Update stopTest() to clear polling intervals

Create src/backend/routes/prisma.routes.ts

GET /api/prisma/status → Returns { available, siteName }

GET /api/tests/:testId/path → Returns current PathResult

GET /api/tests/:testId/path-stream (SSE) → Stream path updates

Update src/backend/server.ts

Initialize PrismaPathService on startup (non-blocking)

Register prisma routes

Add /health endpoint showing Prisma status

PHASE 2: Frontend Implementation
Update src/frontend/components/failover.tsx

Add PathInfo display section below existing test info

Show pathInfo.egressPath when available

Show spinner + "Detecting path..." when not available

Add path type badge (VPN, DirectInternet, ServiceLink)

Style: use existing design system

Create src/frontend/hooks/usePathTracking.ts

Subscribe to path updates via SSE or polling

Return current PathResult

Handle connection errors gracefully

PHASE 3: Docker Configuration
Update Dockerfile

Add Python3 installation: apt-get install -y python3 python3-pip

Add SDK: pip3 install prisma-sase requests urllib3

Copy scripts/getflow.py and make executable

Add HEALTHCHECK command

Update docker-compose.yml

Add environment variables for credentials

Add volume mount for credentials.json (optional)

Add healthcheck configuration

PHASE 4: Testing & Documentation
Add unit tests

PrismaPathService tests with mocked Python execution

Error handling scenarios

Update README.md

Document Prisma integration

Explain environment variables

Add troubleshooting section

CRITICAL REQUIREMENTS:
✅ Never crash the app - All Prisma operations wrapped in try/catch
✅ Graceful degradation - App works completely without Prisma
✅ No blocking - Site detection doesn't delay app startup
✅ Timeouts - All Python calls have 5-10s timeouts
✅ Cleanup - Stop polling when tests end
✅ Memory - Clear intervals and prevent memory leaks

SUCCESS CRITERIA:
 Docker builds without errors, includes Python + Prisma SDK

 App starts successfully with or without credentials

 Site auto-detection works on startup

 Path appears in UI 2+ minutes after test starts

 Path updates every 30 seconds during test

 UI shows "Detecting..." when path unavailable

 App never crashes due to Prisma errors

 Health endpoint shows Prisma status correctly

RECOMMENDED LLM
For this complex integration task, I recommend:

Claude Sonnet 3.5 (Antigravity default) ✅

Best for: Complex TypeScript/React refactoring

Excellent at: Following detailed specs

Handles: Multi-file changes well

Alternative: GPT-4 Turbo

If Sonnet struggles with Python/Node.js interop

Better at: Cross-language integration patterns

DeepSeek V3 (if available in Antigravity)

Excellent at: Large codebase understanding

Cost-effective for iterative development

Start with Claude Sonnet 3.5 - it handles this spec size and complexity very well.
